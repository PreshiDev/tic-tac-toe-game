<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe â€“ Multiplayer</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
    text-align: center;
    padding: 10px;
}

h1 { margin-top: 10px; }

button, input, select {
    padding: 12px 16px;
    margin: 6px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
}

button {
    background: #2563eb;
    color: white;
    cursor: pointer;
}

button:hover { background: #1d4ed8; }

.board {
    display: grid;
    grid-template-columns: repeat(3, 120px);
    gap: 12px;
    justify-content: center;
    margin: 20px auto;
}

.cell {
    width: 120px;
    height: 120px;
    background: #1e293b;
    font-size: 64px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 14px;
}

.cell:hover { background: #334155; }

#status { font-size: 18px; }

.room-box input {
    width: 90%;
    max-width: 420px;
    font-size: 14px;
}

/* ðŸŽ‰ MODAL */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: #020617;
    padding: 30px;
    border-radius: 16px;
    max-width: 300px;
    text-align: center;
    animation: pop 0.3s ease;
}

.modal-content h2 {
    font-size: 28px;
    margin-bottom: 10px;
}

.modal-content p {
    font-size: 48px;
}

@keyframes pop {
    from { transform: scale(0.7); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

@media (max-width: 600px) {
    .board {
        grid-template-columns: repeat(3, 28vw);
        gap: 4vw;
    }
    .cell {
        width: 28vw;
        height: 28vw;
        font-size: 18vw;
    }
    button, select, input {
        width: 90%;
        font-size: 18px;
    }
}
</style>
</head>

<body>

<h1>Tic Tac Toe</h1>

<select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
</select>

<br>

<button onclick="startVsComputer()">Play vs Computer</button>
<button onclick="createRoom()">Create Multiplayer Room</button>

<div class="room-box" id="roomBox" style="display:none;">
    <input id="roomCode" readonly>
    <button onclick="copyCode()">Copy Code</button>
    <input id="roomLink" readonly>
    <button onclick="copyLink()">Copy Link</button>
</div>

<br>

<input id="roomInput" placeholder="Paste Room Code">
<button onclick="joinRoom()">Join Room</button>

<p id="status"></p>

<div class="board">
    <div class="cell" data-i="0"></div>
    <div class="cell" data-i="1"></div>
    <div class="cell" data-i="2"></div>
    <div class="cell" data-i="3"></div>
    <div class="cell" data-i="4"></div>
    <div class="cell" data-i="5"></div>
    <div class="cell" data-i="6"></div>
    <div class="cell" data-i="7"></div>
    <div class="cell" data-i="8"></div>
</div>

<button onclick="resetGame()">Reset</button>

<!-- ðŸŽ‰ RESULT MODAL -->
<div class="modal" id="resultModal">
    <div class="modal-content">
        <p id="resultEmoji">ðŸŽ‰</p>
        <h2 id="resultText"></h2>
        <button onclick="closeModal()">Play Again</button>
    </div>
</div>

<script src="https://unpkg.com/simple-peer/simplepeer.min.js"></script>

<script>
let board = Array(9).fill("");
let currentPlayer = "X";
let mode = null;
let peer = null;
let mySymbol = "X";
let difficulty = "easy";
let lastSignal = "";

const cells = document.querySelectorAll(".cell");
cells.forEach(c => c.onclick = () => makeMove(c.dataset.i));

const wins = [
 [0,1,2],[3,4,5],[6,7,8],
 [0,3,6],[1,4,7],[2,5,8],
 [0,4,8],[2,4,6]
];

function updateUI() {
    cells.forEach((c,i)=>c.textContent = board[i]);
}

function checkWin(p) {
    return wins.some(w => w.every(i => board[i] === p));
}

function showResult(type) {
    const modal = document.getElementById("resultModal");
    const text = document.getElementById("resultText");
    const emoji = document.getElementById("resultEmoji");

    if (type === "win") {
        text.textContent = "You Win!";
        emoji.textContent = "ðŸ†";
    } else if (type === "lose") {
        text.textContent = "You Lose!";
        emoji.textContent = "ðŸ˜­";
    } else {
        text.textContent = "It's a Draw!";
        emoji.textContent = "ðŸ¤";
    }

    modal.style.display = "flex";
}

function closeModal() {
    document.getElementById("resultModal").style.display = "none";
    resetGame();
}

/* ---------- COMPUTER MODE ---------- */
function startVsComputer() {
    resetGame();
    mode = "ai";
    difficulty = document.getElementById("difficulty").value;
}

function aiMove() {
    let empty = board.map((v,i)=>v==""?i:null).filter(v=>v!==null);
    if (!empty.length) return;
    board[empty[Math.floor(Math.random()*empty.length)]] = "O";
    updateUI();
}

/* ---------- MULTIPLAYER ---------- */
function createRoom() {
    resetGame();
    mode = "mp";
    mySymbol = "X";
    peer = new SimplePeer({ initiator:true, trickle:false });

    peer.on("signal", d => {
        lastSignal = btoa(JSON.stringify(d));
        roomBox.style.display = "block";
        roomCode.value = lastSignal;
        roomLink.value = location.origin + location.pathname + "#room=" + lastSignal;
    });

    peer.on("data", d => syncState(JSON.parse(d)));
}

function joinRoom(code=null) {
    resetGame();
    mode = "mp";
    mySymbol = "O";
    const joinCode = code || roomInput.value;
    peer = new SimplePeer({ initiator:false, trickle:false });
    peer.signal(JSON.parse(atob(joinCode)));
    peer.on("data", d => syncState(JSON.parse(d)));
}

function syncState(d) {
    board = d.board;
    currentPlayer = d.currentPlayer;
    updateUI();
}

/* ---------- GAME ---------- */
function makeMove(i) {
    if (board[i] || (mode==="mp" && currentPlayer!==mySymbol)) return;

    board[i] = currentPlayer;
    updateUI();

    if (checkWin(currentPlayer)) {
        if (mode === "ai") showResult(currentPlayer==="X"?"win":"lose");
        else showResult(currentPlayer===mySymbol?"win":"lose");
        return;
    }

    if (!board.includes("")) {
        showResult("draw");
        return;
    }

    currentPlayer = currentPlayer==="X"?"O":"X";

    if (mode==="ai" && currentPlayer==="O") {
        setTimeout(() => { aiMove(); currentPlayer="X"; }, 300);
    }

    if (mode==="mp") peer.send(JSON.stringify({board,currentPlayer}));
}

function resetGame() {
    board = Array(9).fill("");
    currentPlayer = "X";
    updateUI();
}

function copyCode() {
    navigator.clipboard.writeText(lastSignal);
    alert("Room code copied!");
}

function copyLink() {
    navigator.clipboard.writeText(roomLink.value);
    alert("Room link copied!");
}

if (location.hash.startsWith("#room=")) {
    joinRoom(location.hash.replace("#room=",""));
}
</script>

</body>
</html>
