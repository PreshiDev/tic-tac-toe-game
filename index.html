<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe â€“ Multiplayer</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
    text-align: center;
    padding: 10px;
}

h1 { margin-top: 10px; }

button, input, select {
    padding: 12px 16px;
    margin: 6px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
}

button {
    background: #2563eb;
    color: white;
    cursor: pointer;
}

button:hover { background: #1d4ed8; }

.board {
    display: grid;
    grid-template-columns: repeat(3, 120px);
    gap: 12px;
    justify-content: center;
    margin: 20px auto;
}

.cell {
    width: 120px;
    height: 120px;
    background: #1e293b;
    font-size: 64px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 14px;
}

.cell:hover { background: #334155; }

#status {
    margin-top: 10px;
    font-size: 18px;
}

/* ðŸ“± MOBILE VIEW */
@media (max-width: 600px) {
    .board {
        grid-template-columns: repeat(3, 28vw);
        gap: 4vw;
    }

    .cell {
        width: 28vw;
        height: 28vw;
        font-size: 18vw;
    }

    button, select, input {
        width: 90%;
        font-size: 18px;
    }
}
</style>
</head>

<body>

<h1>Tic Tac Toe</h1>

<select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
</select>

<br>

<button onclick="startVsComputer()">Play vs Computer</button>
<button onclick="createRoom()">Create Multiplayer Room</button>

<br>

<input id="roomInput" placeholder="Enter Room Code">
<button onclick="joinRoom()">Join Room</button>

<p id="status"></p>

<div class="board">
    <div class="cell" data-i="0"></div>
    <div class="cell" data-i="1"></div>
    <div class="cell" data-i="2"></div>
    <div class="cell" data-i="3"></div>
    <div class="cell" data-i="4"></div>
    <div class="cell" data-i="5"></div>
    <div class="cell" data-i="6"></div>
    <div class="cell" data-i="7"></div>
    <div class="cell" data-i="8"></div>
</div>

<button onclick="resetGame()">Reset</button>

<script src="https://unpkg.com/simple-peer/simplepeer.min.js"></script>

<script>
let board = Array(9).fill("");
let currentPlayer = "X";
let mode = null;
let peer = null;
let mySymbol = "X";
let difficulty = "easy";

const cells = document.querySelectorAll(".cell");
const statusText = document.getElementById("status");

cells.forEach(c => c.onclick = () => makeMove(c.dataset.i));

const wins = [
 [0,1,2],[3,4,5],[6,7,8],
 [0,3,6],[1,4,7],[2,5,8],
 [0,4,8],[2,4,6]
];

function updateUI() {
    cells.forEach((c,i)=>c.textContent = board[i]);
}

function checkWin(p) {
    return wins.some(w => w.every(i => board[i] === p));
}

/* ---------- COMPUTER MODE ---------- */
function startVsComputer() {
    resetGame();
    mode = "ai";
    difficulty = document.getElementById("difficulty").value;
    statusText.textContent = `You are X | Difficulty: ${difficulty.toUpperCase()}`;
}

function aiMove() {
    let move;

    if (difficulty === "easy") {
        move = randomMove();
    } else if (difficulty === "medium") {
        move = Math.random() < 0.5 ? randomMove() : bestMove();
    } else {
        move = bestMove();
    }

    board[move] = "O";
    updateUI();
}

function randomMove() {
    let empty = board.map((v,i)=>v==""?i:null).filter(v=>v!==null);
    return empty[Math.floor(Math.random()*empty.length)];
}

/* ---------- HARD AI (MINIMAX) ---------- */
function bestMove() {
    let bestScore = -Infinity;
    let move;
    board.forEach((v,i)=>{
        if (v==="") {
            board[i]="O";
            let score = minimax(board,0,false);
            board[i]="";
            if (score > bestScore) {
                bestScore = score;
                move = i;
            }
        }
    });
    return move;
}

function minimax(b,depth,isMax) {
    if (checkWin("O")) return 10-depth;
    if (checkWin("X")) return depth-10;
    if (!b.includes("")) return 0;

    if (isMax) {
        let best = -Infinity;
        b.forEach((v,i)=>{
            if (v==="") {
                b[i]="O";
                best = Math.max(best, minimax(b,depth+1,false));
                b[i]="";
            }
        });
        return best;
    } else {
        let best = Infinity;
        b.forEach((v,i)=>{
            if (v==="") {
                b[i]="X";
                best = Math.min(best, minimax(b,depth+1,true));
                b[i]="";
            }
        });
        return best;
    }
}

/* ---------- MULTIPLAYER ---------- */
function createRoom() {
    resetGame();
    mode = "mp";
    mySymbol = "X";

    peer = new SimplePeer({ initiator:true, trickle:false });
    peer.on("signal", d => alert("Room Code:\n"+btoa(JSON.stringify(d))));
    peer.on("data", d => syncState(JSON.parse(d)));
    statusText.textContent = "Waiting for player...";
}

function joinRoom() {
    resetGame();
    mode = "mp";
    mySymbol = "O";

    const code = document.getElementById("roomInput").value;
    if (!code) return alert("Enter room code");

    peer = new SimplePeer({ initiator:false, trickle:false });
    peer.signal(JSON.parse(atob(code)));
    peer.on("data", d => syncState(JSON.parse(d)));
    statusText.textContent = "Connected!";
}

function syncState(d) {
    board = d.board;
    currentPlayer = d.currentPlayer;
    updateUI();
    statusText.textContent =
        currentPlayer === mySymbol ? "Your turn" : "Opponent's turn";
}

/* ---------- GAME LOGIC ---------- */
function makeMove(i) {
    if (board[i] !== "") return;
    if (mode === "mp" && currentPlayer !== mySymbol) return;

    board[i] = currentPlayer;
    currentPlayer = currentPlayer === "X" ? "O" : "X";
    updateUI();

    if (checkWin(board[i])) {
        statusText.textContent = board[i] + " wins!";
        return;
    }

    if (mode === "ai" && currentPlayer === "O") {
        setTimeout(() => {
            aiMove();
            currentPlayer = "X";
        }, 300);
    }

    if (mode === "mp") {
        peer.send(JSON.stringify({ board, currentPlayer }));
    }
}

function resetGame() {
    board = Array(9).fill("");
    currentPlayer = "X";
    updateUI();
    statusText.textContent = "";
}
</script>

</body>
</html>
